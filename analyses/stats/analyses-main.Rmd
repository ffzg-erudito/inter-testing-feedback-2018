---
fontsize: 11pt
geometry: margin=1.8cm
output:
  pdf_document:
    keep_tex: true
    toc: false
header-includes: |
    \usepackage[natbibapa, sectionbib, tocbib]{apacite}
    \usepackage{microtype}
    \usepackage[utf8]{inputenc}
    \usepackage{caption}
    \usepackage{bookman}
    \usepackage{multirow}
    \usepackage{array}
    \usepackage{float}
    \usepackage[htt]{hyphenat}
    \usepackage{booktabs}
    \usepackage[euler]{textgreek}
    \usepackage{float}
    \usepackage[onehalfspacing]{setspace}
    \captionsetup[table]{width=\textwidth}
    \hypersetup{colorlinks = true, linkcolor = blue, urlcolor = red}
---

```{r setup, echo = F, include = F}
library(knitr)
opts_chunk$set(dpi = 600, dev = 'pdf', echo = F, include = F)
options(digits = 5, scipen = 10)

library(here)
# NOTE: this will load {magrittr}, {here}, {conflicted} and {tidyverse}. also,
# `conflict_prefer`s filter from {dplyr}
# furthermore, it loads 3 data.frames: (1) `dat` which contains the pooled data run
# through `2-wrangling-main.R`, (2) `datHard` which is `dat` with all the hard
# exclusion criteria applied (as described in `analysis-plan.md`), and (3)
# `datSoft` which is `datHard` with the soft exclusion criteria applied (as
# described in `analysis-plan.md`)
source(here('wrangling', '3-exclusion-criteria.R'))
# for Henze-Zirkler
library(MVN)
# for Box's M
library(heplots)
# colorscale
library(viridis)
# multivariate outliers
library(mvoutlier)
# for LDA
library(candisc)
library(MASS)
# for labels in ggplots
library(ggrepel)
# for different sums of squares
library(car)
# for ancova effects
library(effects)
# for tables
library(kableExtra)

library(psych)

conflict_prefer('select', 'dplyr')
theme_set(theme_minimal())

# source helper functions
source(here('helpers', 'manova-helpers.R'))
```

\twocolumn

## Results

### Exclusion criteria

```{r descTable, results = 'asis', include = T}
.a <- by(datHard$totalCorrect, datHard$condition, describe) %>%
  map_dfr(., rbind) %>%
  select(., n, mean, se, sd, min, max, skew, kurtosis)
  
.b <- by(datHard$totalIntrusors, datHard$condition, describe) %>%
  map_dfr(., rbind) %>%
  select(., n, mean, se, sd, min, max, skew, kurtosis)
  
rbind(.a, .b) %>%
  rename(., '$n$' = n, '$M$' = mean, '$SE$' = se, '$SD$' = sd) %>%
  cbind(Measure = c(rep('Total correct', 5), rep('Total intrusors', 5)),
        Condition = rep(c("Content, feedback", "Content, no feedback",
                          "General, feedback", "General, no feedback",
                          "Rereading")), .) %>% 
  kable(., caption = '\\label{descTable} Descriptive statistics for the
                     number of correct answers and chosen intrusors broken down
                     by experimental condition.',
        format = 'latex', booktabs = T, table.env = 'table*',
        digits = 3, escape = F) %>% 
  collapse_rows(., columns = 1, latex_hline = 'major') %>% 
  kable_styling(latex_options = c('scale_down', 'hold_position'))
```

Prior to analysing the data, we have excluded participants based on a priori
set criteria. Participants who have spent less than or equal to 90 seconds
on the practice text were excluded
(`r nrow(dat) - dat %>% filter(., readingTime > 90) %>% nrow(.)` exclusion).
Further, we wanted to exclude participants who have had no correct answers on
the final test
(`r dat %>% filter(., readingTime > 90) %>% nrow(.) -
{dat %>% filter(., readingTime > 90 & totalCorrect > 0) %>% nrow(.)}` exclusions).
Finally, we have excluded participants who have stated that they have reading
deficits
(`r dat %>% filter(., readingTime > 90 & totalCorrect > 0) %>% nrow(.) -
{dat %>% filter(., readingTime > 90 & totalCorrect > 0 &
readingDeficits == 'NE')%>% nrow(.)}` exclusions). This left us with a total sample
of `r nrow(datHard)` participants. The descriptives for the sample are shown
in Table \ref{descTable}.
There is another set of exclusion criteria
based on the number of times the participants have read each of the three texts.
These are used in robustness check analyses (see suplementary materials).

### Interpolated activity effect

```{r datHardNofeedFilter}
datHardNofeed <- datHard %>% filter(., giveFeedback == F) %>%
  select(., activityFactor, totalCorrect, totalIntrusors)
datHardNofeed$activityFactor %<>% as.factor(.)
```

Our first two hypotheses are concerned with the effects of different interpolated
activities on the total number of correct answers and total number of intrusive
distractors chosen. To test these hypotheses, we have focused only on the groups
which have not received feedback, since there was no feedback option for the
rereading group (\(n\) = `r nrow(datHardNofeed)`).
We conducted a one-way MANOVA with interpolated activity as
the independent variable and the total number of correct and intrusive options
chosen as dependent variables. The correlation between our DVs calculated on the
whole sample is
`r datHard %>% select(totalCorrect, totalIntrusors) %>% corr.test(.) -> .;
pluck(., 'r') %>% .[1,2] %>% round(., 2)`
(95% CI: [`r pluck(., 'ci') %>% pull(lower) %>% round(., 2)`,
`r pluck(., 'ci') %>% pull(upper) %>% round(., 2)`],
\(p\) = \(`r datHard %>% select(totalCorrect, totalIntrusors) %>% corr.test(.) -> .;
pluck(., 'p') %>% .[1,2]`\)). Boxplots for the groups in this analysis are shown
in Figure \ref{box1}.

```{r boxPlot, include = T, fig.align = 'center', fig.cap = '\\label{box1} Boxplots broken down by experimental condition and dependent variable, with overlayed raw scores.', fig.env = 'figure*', message = F}
datHardNofeed %>%
  mutate_at(vars(activityFactor), fct_relevel,
            'rereading', 'general', 'content') %>%
  mutate_at(vars(activityFactor), fct_recode,
            'Rereading' = 'rereading', 'General' = 'general',
            'Content' = 'content') %>%
  gather(., totalCorrect, totalIntrusors, key = 'dependentVar',
         value = 'score') %>%
  ggplot(., aes(x = activityFactor, y = score)) +
  geom_boxplot(alpha = .5) + geom_dotplot(mapping = aes(y = score),
                                          binaxis = 'y',
                                stackdir = 'centerwhole', dotsize = .5,
                                fill = 'black', color = 'black') +
  xlab('Condition') + ylab('Score') +
  facet_grid(dependentVar~.,
             labeller = as_labeller(c('totalCorrect' = 'Total correct',
                                      'totalIntrusors' = 'Total intrusors'))) +
  theme(panel.spacing.y = unit(2, 'line'))
```

```{r manovaInterpActivity}
manovaModel <- manova(data = datHardNofeed,
                      cbind(totalCorrect, totalIntrusors) ~ activityFactor)
```

Pillai's V for the analysis is
`r summary(manovaModel) %>% pluck(., 'stats') %>% .[1, 'Pillai']`,
\(p\) = `r summary(manovaModel) %>% pluck(., 'stats') %>% .[1, 'Pr(>F)']`
(Wilks' \(\Lambda\) =
`r summary(manovaModel, test = 'Wilks') %>% pluck(., 'stats') %>% .[1, 'Wilks']`,
\(p\) = `r summary(manovaModel, test = 'Wilks') %>% pluck(., 'stats') %>% .[1, 'Pr(>F)']`;
Hotelling-Lawley's trace =
`r summary(manovaModel, test = 'Hotelling-Lawley') %>% pluck(., 'stats') %>% .[1, 'Hotelling-Lawley']`,
\(p\) = `r summary(manovaModel, test = 'Hotelling-Lawley') %>% pluck(., 'stats') %>% .[1, 'Pr(>F)']`;
Roy's largest root =
`r summary(manovaModel, test = 'Roy') %>% pluck(., 'stats') %>% .[1, 'Roy']`,
\(p\) = `r summary(manovaModel, test = 'Roy') %>% pluck(., 'stats') %>% .[1, 'Pr(>F)']`).
The effect size, calculated as
\(\omega^2_{mult}\) = `r summary(manovaModel, test = 'Wilks') -> .;
omegaSquared(nrow(manovaModel$residuals), .$stats[1, 'Wilks'], .$stats[1, 'Df'])`.

To further inspect the relationship of the interpolated activities with our
dependent variables, we have conducted a Roy-Bargmann stepdown analysis, as
suggested by \citeauthor{tabachnick_using_2012} (\citeyear{tabachnick_using_2012};
a linear discriminant analysis with the same aim is available in the supplementary
materials). The total number of correct answers was a priori chosen to be the
higher priority variable. Therefore, we first conducted an ANOVA with interpolated
activity type as the indepedent variable and the total number of correct answers
as the dependent variable.

```{r royBargmann1}
# anova
anovaRB <- aov(totalCorrect ~ activityFactor, datHardNofeed)
Anova(anovaRB)

# ancova with totalCorrect as covariate
ancovaRB <- aov(totalIntrusors ~ totalCorrect + activityFactor, datHardNofeed)
Anova(ancovaRB, type = '3')

effect('activityFactor', ancovaRB, se = T) %>% summary(.)
```

As could be expected, the ANOVA points to an interpolated activity effect, with
\(F(2, 119)\) = `r anovaRB %>% broom::tidy(.) %>% select(., statistic) %>%
slice(1)`, \(p\) = `r anovaRB %>% broom::tidy(.) %>%
select(., p.value) %>% slice(1)`.

### The interaction between feedback and interpolated activity type

```{r datHardFeedFilter}
datHardFeed <- datHard %>% filter(., activityFactor != 'rereading') %>%
  select(., activityFactor, totalCorrect, totalIntrusors)
```

The remaining hypotheses deal with the effect of feedback on the total number of
correct answers and the total number of intrusors. Therefore, these analyses are
carried out only on the data from participants in the general and content related
test conditions (\(n\) = `r nrow(datHard)`). To test these hypotheses, we first
conducted a two-way MANOVA with interpolated activity and feedback as independent
variables, and total number of correct answers and total number of intrusors as
the dependent variables.

### Additional analyses

\onecolumn

## References

\bibliographystyle{apacite}
\bibliography{../../paper/reference.bib}